from app.graph.state import GraphState

def intent_node(state: GraphState):
    print("ğŸŸ  intent_node ì‹¤í–‰")

    text = state["user_input"]
    text_clean = text.replace(" ", "")

    # ------------------------------
    # CONNECT (ë³µì§€ ì—°ê²° + ê°€ì¡± ì—°ê²° + ì•ˆë¶€ ëŒ€í™”)
    # ------------------------------
    connect_keywords = [
        # ê¸°ë³¸ ëŒ€í™”
        "ì•ˆë…•", "ê³ ë§ˆì›Œ", "ì˜¤ëŠ˜", "ë‚ ì”¨", "ëŒ€í™”", "ì‘", "ê·¸ë˜",

        # ë³µì§€ ì—°ê²° ê´€ë ¨
        "ë°°ìš°", "ë°°ìš°ê³ ", "ë°°ìš°ê³ ì‹¶", "í•˜ê³ ì‹¶", "í•´ë³´ê³ ", "ê°€ë³´ê³ ", "ê°€ê³ ì‹¶",
        "ì·¨ë¯¸", "ê´€ì‹¬", "í™œë™", "ìˆ˜ì—…", "ê°•ì¢Œ", "ì°¸ì—¬", "í”„ë¡œê·¸ë¨",

        # ê°€ì¡± ì—°ê²° ê´€ë ¨
        "ê°€ì¡±", "ì•„ë“¤", "ë”¸", "ì†ì£¼", "ë‚¨í¸", "ì•„ë‚´", "ì–´ë¨¸ë‹ˆ", "ì•„ë²„ì§€",
        "ë³´ê³ ì‹¶", "ê·¸ë¦½", "ì „í™”", "ì—°ë½"
    ]

    if any(kw in text_clean for kw in connect_keywords):
        return {**state, "intent": "connect"}


    # ------------------------------
    # MEMORY (ì¼ì •, ì•ŒëŒ, ë°˜ë³µ ì§ˆë¬¸)
    # ------------------------------
    memory_keywords = [
        # ì¼ì • ìƒì„±/ì¡°íšŒ/ìˆ˜ì • ë“± ê³µí†µ í‚¤ì›Œë“œ
        "ì¼ì •", "ìŠ¤ì¼€ì¤„", "ì•½ì†", "ê¸°ì–µ", "ì•½"

        # ì•ŒëŒ ê´€ë ¨
        "ì•ŒëŒ", "ë¦¬ë§ˆì¸ë“œ", "ê¹¨ì›Œì¤˜",

        # ë°˜ë³µ ì§ˆë¬¸ ê´€ë ¨
        "ë‹¤ì‹œë§", "ë­ë¼í–ˆì§€", "ë­ë¼ê³ í–ˆì§€", "ê¸°ì–µì•ˆë‚˜", "ëª‡ì‹œì§€"
    ]

    if any(kw in text_clean for kw in memory_keywords):
        return {**state, "intent": "memory"}


    # ------------------------------
    # CARE (ê±´ê°•/ìœ„í—˜/ì¦ìƒ)
    # ------------------------------
    care_keywords = [
        "ì•„íŒŒ", "í†µì¦", "í˜ˆì••", "ìˆ¨ë§‰í˜€", "ê¸°ìš´", "ìš°ìš¸", "ìœ„í—˜",
        "êµ¬ê¸‰", "119", "ì–´ì§€ëŸ¬", "ì“°ëŸ¬ì§ˆ", "ì‹¬ì¥", "í˜¸í¡"
    ]

    if any(kw in text_clean for kw in care_keywords):
        return {**state, "intent": "care"}


    # ------------------------------
    # FALLBACK
    # ------------------------------
    return {**state, "intent": "fallback"}

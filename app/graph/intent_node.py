from app.graph.state import GraphState

def intent_node(state: GraphState):
    print("ğŸŸ  intent_node ì‹¤í–‰")

    text = state["user_input"]
    text_clean = text.replace(" ", "")

    # ------------------------------
    # CONNECT (ë³µì§€ ì—°ê²° + ê°€ì¡± ì—°ê²° + ì•ˆë¶€ ëŒ€í™”)
    # ------------------------------
    connect_keywords = [
        # ê¸°ë³¸ ëŒ€í™”
        "ì•ˆë…•", "ê³ ë§ˆì›Œ", "ì˜¤ëŠ˜", "ë‚ ì”¨", "ëŒ€í™”", "ì‘", "ê·¸ë˜",

        # ë³µì§€ ì—°ê²° ê´€ë ¨
        "ë°°ìš°", "ë°°ìš°ê³ ", "ë°°ìš°ê³ ì‹¶", "í•˜ê³ ì‹¶", "í•´ë³´ê³ ", "ê°€ë³´ê³ ", "ê°€ê³ ì‹¶",
        "ì·¨ë¯¸", "ê´€ì‹¬", "í™œë™", "ìˆ˜ì—…", "ê°•ì¢Œ", "ì°¸ì—¬", "í”„ë¡œê·¸ë¨",

        # ê°€ì¡± ì—°ê²° ê´€ë ¨
        "ê°€ì¡±", "ì•„ë“¤", "ë”¸", "ì†ì£¼", "ë‚¨í¸", "ì•„ë‚´", "ì–´ë¨¸ë‹ˆ", "ì•„ë²„ì§€",
        "ë³´ê³ ì‹¶", "ê·¸ë¦½", "ì „í™”", "ì—°ë½"
    ]

    if any(kw in text_clean for kw in connect_keywords):
        return {**state, "intent": "connect"}


    # ------------------------------
    # MEMORY (ì¼ì •, ì•ŒëŒ, ë°˜ë³µ ì§ˆë¬¸)
    # ------------------------------
    memory_keywords = [
        # ì¼ì • ìƒì„±/ì¡°íšŒ/ìˆ˜ì • ë“± ê³µí†µ í‚¤ì›Œë“œ
        "ì¼ì •", "ìŠ¤ì¼€ì¤„", "ì•½ì†", "ê¸°ì–µ", "ì•½",

        # ì•ŒëŒ ê´€ë ¨
        "ì•ŒëŒ", "ë¦¬ë§ˆì¸ë“œ", "ê¹¨ì›Œì¤˜",

        # ë°˜ë³µ ì§ˆë¬¸ ê´€ë ¨
        "ë‹¤ì‹œë§", "ë­ë¼í–ˆì§€", "ë­ë¼ê³ í–ˆì§€", "ê¸°ì–µì•ˆë‚˜", "ëª‡ì‹œì§€"
    ]

    if any(kw in text_clean for kw in memory_keywords):
        return {**state, "intent": "memory"}


    # ------------------------------
    # CARE (ê±´ê°•/ìœ„í—˜/ì¦ìƒ/ê°ì •)
    # ------------------------------
    risk_keywords = [
        "ì“°ëŸ¬ì§ˆ", "ìˆ¨ì´ì•ˆ", "ìˆ¨ì´ë§‰í˜€",
        "119", "ìœ„í—˜", "ì‚´ë ¤ì¤˜", "ë„ì™€ì¤˜",
        "ì‹¬ì¥", "í˜¸í¡ê³¤ë€"
    ]

    positive_keywords = [
        "í–‰ë³µ", "ê¸°ë»", "ì¢‹ì•„", "ê³ ë§ˆì›Œ", "ê°ì‚¬", "ì¬ë°Œ", "ì¦ê±°ì›Œ"
    ]

    neutral_keywords = [
        "ê´œì°®ì•„", "ë³„ì¼ì—†ì–´", "ì°¨ë¶„", "í‰ì˜¨", "ê·¸ëŸ­ì €ëŸ­", "ë¬´ë‚œ"
    ]

    energetic_keywords = [
        "ì˜í–ˆì–´", "í™œê¸°", "ì¢‹ë‹¤", "ì˜ìš•", "í˜ì´ë‚˜", "íŒŒì´íŒ…"
    ]

    tired_keywords = [
        "ê¸°ìš´ì—†", "ì§€ì³", "í”¼ê³¤", "í˜ë“¤ì–´", "ì‰¬ê³ ì‹¶", "ì§€ì¹¨"
    ]

    anxious_keywords = [
        "ë¶ˆì•ˆ", "ê±±ì •", "ì–´ë–¡í•˜", "ê¸´ì¥", "ì´ˆì¡°", "ë¶ˆí¸"
    ]

    pattern_keywords = [
        "ê¸°ìš´", "í˜ì´ì—†ì–´", "ì»¨ë””ì…˜", "ì–´ì§€ëŸ¬",
        "ëª¸ì´ì•ˆì¢‹ì•„", "ë¨¹ê¸°ì‹«ì–´", "ì ì´ì•ˆì™€"
    ]

    care_keywords = (
        risk_keywords
        + positive_keywords
        + neutral_keywords
        + energetic_keywords
        + tired_keywords
        + anxious_keywords
        + pattern_keywords
    )

    if any(kw in text_clean for kw in care_keywords):
        return {**state, "intent": "care"}



    # ------------------------------
    # FALLBACK
    # ------------------------------
    return {**state, "intent": "fallback"}
